<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="junstech.dao.FinancereceivableMapper" >
  <resultMap id="BaseResultMap" type="junstech.model.Financereceivable" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="saleid" property="saleid" jdbcType="BIGINT" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="companyid" property="companyid" jdbcType="BIGINT" />
    <result column="totalamount" property="totalamount" jdbcType="DOUBLE" />
    <result column="nowpay" property="nowpay" jdbcType="DOUBLE" />
    <result column="note" property="note" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="ResultMapWithStatstic" extends="BaseResultMap"
		type="junstech.model.Financereceivable">
		<collection property="customer" javaType="junstech.model.Customer">
			<id property="id" column="customer_ID" />
			<id property="name" column="customer_name" />
			<id property="phone" column="customer_phone" />
			<id property="email" column="customer_email" />
			<id property="credit" column="customer_credit" />
		</collection>
	</resultMap>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from financereceivable
    where saleid = #{saleid,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="junstech.model.Financereceivable" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="id" order="BEFORE" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into financereceivable (id, saleid, type, 
      companyid, totalamount, nowpay, 
      note)
    values (#{id,jdbcType=BIGINT}, #{saleid,jdbcType=BIGINT}, #{type,jdbcType=VARCHAR}, 
      #{companyid,jdbcType=BIGINT}, #{totalamount,jdbcType=DOUBLE}, #{nowpay,jdbcType=DOUBLE}, 
      #{note,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="junstech.model.Financereceivable" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update financereceivable
    <set>
    	<if test="saleid != null ">
		 	saleid = #{saleid,jdbcType=BIGINT},
		</if>
     	<if test="type != null and type != '' ">
			type = #{type,jdbcType=VARCHAR},
		</if>
		<if test="companyid != null ">
		 	companyid = #{companyid,jdbcType=BIGINT},
		</if>
      	<if test="totalamount != null ">
		 	totalamount = #{totalamount,jdbcType=DOUBLE},
		</if>
      	<if test="nowpay != null ">
		 	nowpay = #{nowpay,jdbcType=DOUBLE},
		</if>
      	<if test="note != null and note != '' ">
			note = #{note,jdbcType=VARCHAR}
		</if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, saleid, type, companyid, totalamount, nowpay, note
    from financereceivable
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectAll" resultMap="ResultMapWithStatstic" >
    <include refid="SelectFactors"></include>
  </select>
  <sql id="SelectFactors">
  SELECT
	financereceivable.id,
	financereceivable.saleid,
	financereceivable.type,
	financereceivable.companyid,
	financereceivable.totalamount,
	financereceivable.nowpay,
	financereceivable.note,
	customer.ID customer_ID,
	customer.`name` customer_name,
	customer.address customer_address,
	customer.phone customer_phone,
	customer.email customer_email,
	customer.credit customer_credit 
	FROM
	financereceivable
	JOIN customer ON financereceivable.companyid = customer.ID
  </sql>
  <sql id="SelectSummaryFactors">
  SELECT
	financereceivable.id,
	financereceivable.saleid,
	financereceivable.type,
	financereceivable.companyid,
	sum(financereceivable.totalamount) totalamount,
	sum(financereceivable.nowpay) nowpay,
	financereceivable.note,
	customer.ID customer_ID,
	customer.`name` customer_name,
	customer.address customer_address,
	customer.phone customer_phone,
	customer.email customer_email,
	customer.credit customer_credit 
	FROM
	financereceivable
	JOIN customer ON financereceivable.companyid = customer.ID
  </sql>
  <select id="selectSummaryByPage" resultMap="ResultMapWithStatstic"
	parameterType="java.util.Map">
		<include refid="SelectSummaryFactors"></include>
		WHERE
		(customer.`name` LIKE
		CONCAT(CONCAT('%', #{key}),'%') OR
		financereceivable.type LIKE
		CONCAT(CONCAT('%', #{key}),'%')) 
		<if test="type != null and type != ''">
		AND	type = #{type}
		</if>
		GROUP BY customer.ID, financereceivable.type
		order by financereceivable.nowpay asc
		<if test="prev != null and next != null">
		limit #{prev} , #{next}
		</if>
	</select>
	<select id="selectAllByFields" resultMap="ResultMapWithStatstic"
		parameterType="java.util.Map">
		<include refid="SelectFactors"></include>
		<where>
		<if test="companyid != null ">
			companyid = #{companyid}
		</if>
		<if test="type != null and type != ''">
			type = #{type}
		</if>
		</where>
	</select>
</mapper>